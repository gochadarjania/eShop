@model eShop.Admin.Models.ProductListModel

@{
    ViewData["Title"] = "Products";
}


<div style="float: right; padding-bottom: 6px;">

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        <i class="fas fa-plus-square"></i>
        დამატება
    </button>

    @*<a class="btn btn-primary" href="#">
            <i class="fas fa-plus-square"></i>
            დამატება
        </a>*@

</div>

<div class="dataTables_scroll" style="text-align:center;">

    <div class="dataTables_scrollBody">
        <table class="table table-bordered table-hover table-striped dataTable no-footer" id="productTable">

            <thead>
                <tr role="row">
                    <th>ID</th>
                    <th>სურათი</th>
                    <th>დასახელება</th>
                    <th>ფასი</th>
                    <th>რაოდენობა</th>
                    <th>რედაქტირება/წაშლა</th>

                </tr>
            </thead>

            <tbody>
                @foreach (var item in Model.Products)
                {
                    <tr>
                        <td>@item.Id</td>
                        <td ><img src="@item.ProductImage" width="100"></td>
                        <td >@item.Name</td>
                        <td>@item.Price</td>
                        <td >@item.Quantuty </td>

                        <td class="button-column" style=" vertical-align: middle !important;">

                            <a class="btn btn-outline-dark" href="Edit/1">
                                <i class="fas fa-pencil-alt"></i>&nbspშეცვლა
                            </a>

                            <button type="button" id="delete-selected" class="btn btn-danger" data-toggle="modal" data-target="#delete-selected-action-confirmation" name="">
                                <i class="far fa-trash-alt"></i>
                                წაშლა
                            </button>
                        </td>

                    </tr>
                }


            </tbody>
        </table>
    </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">პროდუქტის დამატება</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="form-group">
                    <input class="form-control" id="Name" placeholder="პროდუქტის დასახელება" />
                </div>


                <div class="form-group">
                    <input class="form-control" id="Price" placeholder="ფასი" />
                </div>


                <div class="form-group">
                    <input class="form-control" id="Quantuty" placeholder="რაოდენობა" />
                </div>


                <div class="form-group">
                    <input class="form-control" id="Description" placeholder="აღწერა" />
                </div>

                <div class="form-group">
                    <input class="form-control" id="Img" placeholder="სურათის ლინკი" />
                </div>

                <div class="form-group" id="Error" style="color:red;">
                </div>

                @*<div class="form-group">
            <input class="form-control" type="file" id="Img" />
        </div>*@


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">დახურვა</button>
                <button type="button" id="save" data-dismiss="modal" class="btn btn-primary">შენახვა</button>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function () {

        $(`#save`).click(function () {

            var data = new FormData();
            /*    var files = $("#Img").get(0).files;*/
            var imgPath = $("#Img").val();
            var name = $("#Name").val();
            var price = $("#Price").val();
            var quantuty = $("#Quantuty").val();
            var description = $("#Description").val();

            //if (files.lenght > 0) {
            //    data.append("Img", files[0]);
            //}

            if (name.trim() == '' || price.trim() == '' || quantuty.trim() == '') {

                $("#Error").html("შეავსე აუცილებელი ველები!!!")
            } else {

                data.append('Name', name);
                data.append('Price', price);
                data.append('Quantuty', quantuty);
                data.append('Description', description);
                data.append('Img', imgPath);

                

                var lastId = parseFloat($('table tr:last-child td:first-child').html())+1;




                $.ajax({
                    type: "POST",
                    url: '@Url.Action("InsertProduct", "Product")',
                    //url: 'Product/InsertProduct',
                    //type: "POST",
                    processData: false,
                    contentType: false,
                    data: data,
                    success: function (response) {
                        $('#productTable').append(`<tr><td>` + lastId + `</td><td><img src="` + imgPath + `" width="100"></td><td>` + name + `</td><td>` + price + `.00` + `</td><td>` + quantuty+`.00` + ` </td><td class="button-column" style="vertical-align:middle!important;"> <a class="btn btn-outline-dark"> <i class="fas fa-pencil-alt"></i>&nbspშეცვლა </a> <button type="buttonid="delete-selected" class="btn btn-danger" data-toggle="modal" data-target="#delete-selected-action-confirmation" > <i class="far fa-trash-alt"></i> წაშლა</button></td> </tr> `);
                       
                    },
                    error: function (er) {
                        alert(er);
                    }

                });
            }

        });
    });

</script>